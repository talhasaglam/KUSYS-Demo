@page
@model KUSYS_Demo.WebApp.Pages.Students.IndexModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<div class="lp-content h-100">

    <div class="card">
        <button onClick="openModal()" type="button" name="entity-create" class="btn btn-primary">Create Student</button>
        <div class="card-body">
            <table id="studentTable" class="table table-striped display nowrap" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>
                            Id
                        </th>
                        <th>
                            FirstName
                        </th>
                        <th>
                            LastName
                        </th>
                        <th>
                            BirthDate
                        </th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

</div>

@section Scripts{
    <script>
        var createUpdateModal = new kusys.ModalManager({
            viewUrl: "/Students/CreateUpdateModal"
        });
        var deleteModal = new kusys.ModalManager({
            viewUrl: "/Students/deleteModal"
        });

        var dataTable = $('#studentTable').DataTable({
            "proccessing": true,
            "serverSide": true,
            "searching": false,
            "ajax": {
                url: "/Students",
                type: 'POST',
                headers: { 'RequestVerificationToken': $('@Html.AntiForgeryToken()').val() }
            },
            "columnDefs": [
                {
                    "targets": -1,
                    "data": "buttons",
                    "orderable": false,
                    "render": function (data, type, row, meta) {
                        let text = '<span class="d-inline-block" data-toggle="tooltip"><a style="border-width:1px;width:28px;"' +
                            ' class="btn btn-sm btn-outline-info p-1 " name="entity-detail" title="' +
                            "Detail" + '" data-rowid="' + row.id + '" ><i class="fa fa-info-circle"></i></a></span>'
                        text += '<span class="d-inline-block" data-toggle="tooltip"><a style="border-width:1px;width:28px;"' +
                            ' class="btn btn-sm btn-outline-info p-1 " name="entity-edit" title="' +
                            "Edit" + '" data-rowid="' + row.id + '" ><i class="fa fa-edit"></i></a></span>'
                        text += '<span class="d-inline-block" data-toggle="tooltip"><a style="border-width:1px;width:28px;"' +
                            ' class="btn btn-sm btn-outline-info p-1 " name="entity-delete" title="' +
                            "Delete" + '" data-rowid="' + row.id + '" ><i class="fa fa-trash"></i></a></span>';
                        return text;
                    }
                },
                { "name": "Id", "data": "id", "targets": 0, "visible": false },
                { "name": "FirstName", "data": "firstName", "targets": 1 },
                { "name": "LastName", "data": "lastName", "targets": 2 },
                { "name": "BirthDate", "data": "birthDate", "targets": 3 }
            ],
            "order": [[0, "desc"]]
        });

        $('#studentTable tbody').on('click', '[name=entity-edit]', function () {
            var rowId = $(this).data('rowid');
            createUpdateModal.open({ id: rowId });
        });

        $('#studentTable tbody').on('click', '[name=entity-delete]', function () {
            var rowId = $(this).data('rowid');
            deleteModal.open({ id: rowId });
        });

        $('#studentTable tbody').on('click', '[name=entity-detail]', function () {
            var rowId = $(this).data('rowid');
            createUpdateModal.open({ id: rowId, readOnly: true });
        });

        function openModal(){
            createUpdateModal.open();
        }

        createUpdateModal.onResult(function () {
            dataTable.ajax.reload(null, false);
        });

        deleteModal.onResult(function () {
            dataTable.ajax.reload(null, false);
        });
    </script>
}
